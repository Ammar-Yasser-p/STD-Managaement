CREATE TABLE Admins(
	Code TINYINT PRIMARY KEY IDENTITY(1,1),
	Name NVARCHAR(50) UNIQUE NOT NULL,
	PW NVARCHAR(50) NOT NULL,
);

CREATE TABLE Grades(
	Code TINYINT PRIMARY KEY IDENTITY(1,1),
	Name NVARCHAR(50) UNIQUE NOT NULL
);

CREATE TABLE Groups(
	Code TINYINT PRIMARY KEY IDENTITY(1,1),
	Name NVARCHAR(50) UNIQUE NOT NULL,
	GradeCode TINYINT NOT NULL,
	GradeName NVARCHAR(50) NOT NULL,
	Days NVARCHAR(50) NOT NULL,
	Time NVARCHAR(50) NOT NULL,
	FOREIGN KEY (GradeCode) REFERENCES Grades(Code)
);

CREATE TABLE Students(
	Code INT PRIMARY KEY IDENTITY(1,1),
	Name NVARCHAR(50) UNIQUE NOT NULL,
	GradeCode TINYINT NOT NULL,
	GradeName NVARCHAR(50) NOT NULL,
	GroupCode TINYINT NOT NULL,
	GroupName NVARCHAR(50) NOT NULL,
	Phone NVARCHAR(11) UNIQUE NOT NULL,
	PrtPhone NVARCHAR(11) UNIQUE NOT NULL,
	RegDate DATETIME,
	FOREIGN KEY (GroupCode) REFERENCES Groups(Code),
	FOREIGN KEY (GradeCode) REFERENCES Grades(Code)
);

CREATE TABLE MonthP(
	Code INT PRIMARY KEY IDENTITY(1,1),
	YearP NVARCHAR(4) NOT NULL,
	MonthP NVARCHAR(2) NOT NULL,
	GradeCode TINYINT NOT NULL,
	GradeName NVARCHAR(50) NOT NULL,
	Price DECIMAL(4) NOT NULL,
	FOREIGN KEY (GradeCode) REFERENCES Grades(Code),
	CONSTRAINT unique_year_month UNIQUE (YearP, MonthP , GradeCode)
);

CREATE TABLE Payments(
	Code INT PRIMARY KEY IDENTITY(1,1),
	MonthPCode INT NOT NULL,
	stdCode INT NOT NULL,
	stdName NVARCHAR(50) NOT NULL,
	GradeCode TINYINT NOT NULL,
	GradeName NVARCHAR(50) NOT NULL,
	GroupCode TINYINT NOT NULL,
	GroupName NVARCHAR(50) NOT NULL,
	YearP NVARCHAR(4) NOT NULL,
	MonthP NVARCHAR(2) NOT NULL,
	MPrice DECIMAL(4) NOT NULL,
	State BIT DEFAULT 0,
	Discount DECIMAL(4) DEFAULT 0,
	Paid DECIMAL(4) DEFAULT 0,
	Date DATETIME,
	FOREIGN KEY (GradeCode) REFERENCES Grades(Code),
	FOREIGN KEY (MonthPCode) REFERENCES MonthP(Code),
	CONSTRAINT unique_payment UNIQUE (MonthPCode, stdCode)
);

CREATE TABLE StudentPres(
	stdCode INT NOT NULL,
	stdName NVARCHAR(50) NOT NULL,
	Mark NVARCHAR(7) NULL,
	GradeCode TINYINT NOT NULL,
	GradeName NVARCHAR(50) NOT NULL,
	GroupCode TINYINT NOT NULL,
	GroupName NVARCHAR(50) NOT NULL,
	DayDate NVARCHAR(10) NOT NULL,
	DayName NVARCHAR(10) NOT NULL,
	Presence BIT DEFAULT 0,
	Tpres DATETIME NULL,
	Topen DATETIME NOT NULL,
	Method NVARCHAR(50) NOT NULL,
	ID INT PRIMARY KEY IDENTITY(1,1),
	FOREIGN KEY (GroupCode) REFERENCES Groups(Code),
	FOREIGN KEY (GradeCode) REFERENCES Grades(Code),
	CONSTRAINT unique_base_pres UNIQUE (DayDate, Method , stdCode)
);

CREATE TABLE ActivityLog(
	LogID INT PRIMARY KEY IDENTITY,
	ActivityType NVARCHAR(50) NOT NULL,
	TableName NVARCHAR(50),
	RecordID NVARCHAR(50),
	UserCode NVARCHAR(50),
	UserName NVARCHAR(50),
	Timestamp DATETIME NOT NULL,
	AdditionalInfo NVARCHAR(MAX)
);
